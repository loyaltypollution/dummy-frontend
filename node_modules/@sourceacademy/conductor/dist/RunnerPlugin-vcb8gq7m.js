import{C as t}from"./ConductorInternalError-Bfjhowsx.js";import{i as s}from"./importExternalModule-8c1kBggZ.js";import{i as e}from"./importExternalPlugin-Grm0p47A.js";import{C as i}from"./ChannelQueue-Bmt4Qwn3.js";import{makeRpc as r}from"./conduit/rpc/index.js";import"./conductor/types/moduleInterface/index.js";import{A as n,H as o}from"./HelloServiceMessage-Bb4XIsxg.js";import{P as a}from"./PluginServiceMessage-BqOS8Sde.js";class u{name="__runner_main";t;i;o;u;h;l;_;p;m;v=new Map;C=new Map([[0,function(t){t.data.version<0?(this.l.send(new n(0)),console.error(`Host's protocol version (${t.data.version}) must be at least 0`)):console.log(`Host is using protocol version ${t.data.version}`)}],[1,function(t){console.error(`Host expects at least protocol version ${t.data.minVersion}, but we are on version 0`),this.o.terminate()}],[2,function(t){this.t.startEvaluator(t.data)}]]);requestFile(t){return this.u.requestFile(t)}async requestChunk(){return(await this.h.receive()).chunk}async requestInput(){const{message:t}=await this._.receive();return t}tryRequestInput(){const t=this._.tryReceive();return t?.message}sendOutput(t){this._.send({message:t})}sendError(t){this.p.send({error:t})}updateStatus(t,s){this.v.set(t,s),this.m.send({status:t,isActive:s})}isStatusActive(t){return this.v.get(t)??!1}hostLoadPlugin(t){this.l.send(new a(t))}registerPlugin(t,...s){return this.o.registerPlugin(t,...s)}unregisterPlugin(t){this.o.unregisterPlugin(t)}registerModule(s){if(!this.i)throw new t("Evaluator has no data interface");return this.registerPlugin(s,this.t)}unregisterModule(t){this.unregisterPlugin(t)}async importAndRegisterExternalPlugin(t,...s){const i=await e(t);return this.registerPlugin(i,...s)}async importAndRegisterExternalModule(t){const e=await s(t);return this.registerModule(e)}static channelAttach=["__file_rpc","__chunk","__service","__stdio","__error","__status"];constructor(t,[s,e,n,a,u,h],c){this.o=t,this.u=r(s,{}),this.h=new i(e),this.l=n,this._=new i(a),this.p=u,this.m=h,this.l.send(new o),this.l.subscribe(t=>{this.C.get(t.type)?.call(this,t)}),this.t=new c(this),this.i=this.t.hasDataInterface??!1}}export{u as R};
//# sourceMappingURL=RunnerPlugin-vcb8gq7m.js.map
