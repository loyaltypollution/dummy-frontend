import{i as t}from"../../importExternalPlugin-Grm0p47A.js";import{makeRpc as s}from"../../conduit/rpc/index.js";import"../types/moduleInterface/index.js";import{A as e,H as i}from"../../HelloServiceMessage-Bb4XIsxg.js";import{E as n}from"../../EntryServiceMessage-AF4AAdeZ.js";import"../../conduit/rpc/types/index.js";class r{name="__host_main";t;i;o;h;u=0;_=new Map([[0,function(t){t.data.version<0?(this.o.send(new e(0)),console.error(`Runner's protocol version (${t.data.version}) must be at least 0`)):console.log(`Runner is using protocol version ${t.data.version}`)}],[1,function(t){console.error(`Runner expects at least protocol version ${t.data.minVersion}, but we are on version 0`),this.t.terminate()}],[3,function(t){const s=t.data;this.requestLoadPlugin(s)}]]);startEvaluator(t){this.o.send(new n(t))}sendChunk(t){this.i.send({id:this.u++,chunk:t})}sendInput(t){this.h.send({message:t})}registerPlugin(t,...s){return this.t.registerPlugin(t,...s)}unregisterPlugin(t){this.t.unregisterPlugin(t)}async importAndRegisterExternalPlugin(s,...e){const i=await t(s);return this.registerPlugin(i,...e)}static channelAttach=["__file_rpc","__chunk","__service","__stdio","__error","__status"];constructor(t,[e,n,r,o,c,a]){this.t=t,s(e,{requestFile:this.requestFile.bind(this)}),this.i=n,this.o=r,this.h=o,o.subscribe(t=>this.receiveOutput?.(t.message)),c.subscribe(t=>this.receiveError?.(t.error)),a.subscribe(t=>{const{status:s,isActive:e}=t;this.receiveStatusUpdate?.(s,e)}),this.o.send(new i),this.o.subscribe(t=>{this._.get(t.type)?.call(this,t)})}}export{r as BasicHostPlugin};
//# sourceMappingURL=index.js.map
